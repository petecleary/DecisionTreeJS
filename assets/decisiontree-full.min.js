(function(){function a(e,t,n,r,i){var s=new Array;n=n||function(){};if(!t){t=new Object}if(!i){s=new Array}if(!e){return n()}var s=new Array;var o=e;var u=function(e,i){o=i;if(e){return n(e,t,s)}else{o.processed=true;o.processCount+=1;switch(o.shapeType.toLowerCase()){case"entry":{s.push(o);nextTick(function(){u(null,o.nextShape)});break};case"operation":{o.nextShape=o.nextShape||{id:-1,shapeType:"Terminator",description:"End"};if(!o.process){o.process=h(o.processName,r)}o.process(t,o,function(e,t){s.push(t);nextTick(function(){u(e,t.nextShape)})});break};case"decision":{if(!o.process){o.process=h(o.processName,r)}if(!o.decide){o.decide=h(o.decideName,r)}o.nextShape=null;o.process(t,o,function(r,i){s.push(i);if(e){return n(null,t,s)}nextTick(function(){a(i)})});break};case"terminator":{s.push(o);return n(null,t,s);break}}}};var a=function(e){e.decide=e.decide||function(e,t){e.nextShape=e.nextShape||(this.paths.length>0?this.paths[0].nextShape:{id:-1,shapeType:"Terminator",description:"End"});u(e.nextShape)};e.decide(t,e,f)};var f=function(e,t){if(!t.nextShape){var n=false;for(var r=0;r<t.paths.length;r++){if(t.paths[r].selected){n=true;if(!t.paths[r].nextShape){t.nextShape=l(t.paths[r].nextShapeId)}else{t.nextShape=t.paths[r].nextShape}if(t.nextShape){break}}}}if(!t.nextShape){e=new Error("No following shape found! Check that if using nextShapeId that the id exists")}u(e,t.nextShape)};var l=function(e){for(var t=0;t<s.length;t++){if(s[t].id===e){return s[t]}}return c(s[0],e)};var c=function(e,t){switch(e.shapeType.toLowerCase()){case"entry":{if(e.nextShape.id===t){return e.nextShape}return c(e.nextShape,t)};case"operation":{if(e.nextShape.id===t){return e.nextShape}return c(e.nextShape,t)};case"decision":{for(var n=0;n<e.paths.length;n++){if(e.paths[n].nextShape){if(e.paths[n].nextShape.id===t){return e.paths[n].nextShape}return c(e.nextShape,t)}}};case"terminator":{return null}}return null};var h=function(e,t){var n=typeof t==="undefined"?window:t;var r=e.split(".");var i=r.pop();for(var s=0;s<r.length;s++){n=n[r[s]]}return n[i]};u(null,o)}var e={};var t,n;t=this;if(t!=null){n=t.decisionTree}var r=function(){function e(e){this.shapeType="Entry";this.inititate=function(e){return null};this.id=e&&e.id||0;this.description=e&&e.description||"Start";this.log=e&&e.log||null;this.processed=e&&e.processed||false;this.processCount=e&&e.processCount||0;this.nextShape=e&&e.nextShape||null}return e}();e.Entry=r;var i=function(){function e(e){this.shapeType="Operation";this.process=function(e,t,n){n(null,t)};this.id=e&&e.id||0,this.description=e&&e.description||"Operation";this.log=e&&e.log||null;this.processed=e&&e.processed||false;this.processCount=e&&e.processCount||0;this.nextShape=e&&e.nextShape||null;this.properties=e&&e.properties||null;this.process=e&&e.process||function(e,t,n){n(null,t)};this.processName=e&&e.processName||""}return e}();e.Operation=i;var s=function(){function e(e){this.shapeType="Decision";this.process=function(e,t,n){n(null,t)};this.decide=function(e,t,n){n(null,t)};this.id=e&&e.id||0,this.description=e&&e.description||"Decision";this.log=e&&e.log||null;this.processed=e&&e.processed||false;this.processCount=e&&e.processCount||0;this.paths=e&&e.paths||new Array;this.properties=e&&e.properties||null;this.process=e&&e.process||function(e,t,n){n(null,t)};this.processName=e&&e.processName||"";this.nextShape=e&&e.nextShape||null;this.decide=e&&e.decide||function(e,t,n){n(null,t)};this.decideName=e&&e.decideName||""}return e}();e.Decision=s;var o=function(){function e(e){this.value=e&&e.value||null;this.selected=e&&e.selected||false;this.nextShape=e&&e.nextShape||null;this.nextShapeId=e&&e.nextShapeId||0}return e}();e.DecisionPath=o;var u=function(){function e(e){this.shapeType="Terminator";this.id=e&&e.id||0,this.description=e&&e.description||"End";this.log=e&&e.log||null;this.processed=e&&e.processed||false;this.processCount=e&&e.processCount||0}return e}();e.Terminator=u;if(typeof process==="undefined"||!process.nextTick){nextTick=function(e){setTimeout(e,0)}}else{nextTick=process.nextTick}e.execute=a;if(typeof define!=="undefined"&&define.amd){define([],function(){return e})}else if(typeof module!=="undefined"&&module.exports){module.exports=e}else{t.decisionTree=e}})()