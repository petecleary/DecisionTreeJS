<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>DecisionTreeJS - Examples Node.js Basic App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Decision Tree is a untility module providing asynchronous control flow similar to a flowchart. It can be used within node.js and the browser.">
    <meta name="author" content="Pete Cleary">
    <link href="../../assets/css/bootstrap.css" rel="stylesheet">
    <link href="../../assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="../../assets/css/site.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
    <![endif]-->
    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../../assets/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="../../assets/ico/favicon.png">
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-38592932-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body data-spy="scroll" data-target=".sidebar">
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar">
                    </span>
                </button>
                <a class="brand" href="../../index.html">DecisionTreeJS</a>
                <div class="nav-collapse collapse">
                    <ul id="topNav" class="nav">
                    </ul>
                    <p class="navbar-text pull-right">
                        <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=petecleary&repo=node.js-basic-stack&type=watch&count=true"
                            allowtransparency="true" frameborder="0" scrolling="0" width="60px" height="20px">
                        </iframe>
                        <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=petecleary&repo=decisiontreejs&type=fork&count=true"
                            allowtransparency="true" frameborder="0" scrolling="0" width="60px" height="20px">
                        </iframe>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="headSpace">
    </div>
    <div class="container">
        <!-- Docs nav
    ================================================== -->
        <div class="row">
            <div class="span3 sidebar">
                <ul class="nav nav-list affix">
                    <li><a href="#"><i class="icon-chevron-right"></i>Browser Examples</a>
                        <ul id="exampleNavBrowser" class="nav nav-list">
                        </ul>
                    </li>
                    <li><a href="#"><i class="icon-chevron-right"></i>Node.js Examples</a>
                        <ul id="exampleNavNode" class="nav nav-list">
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="span9">
                <section id="Examples">
                <h1>
                    Basic Application <em><small>[Node.js]</small></em></h1>
    <p>This example is the same as the <a href="../Browser-BasicApp">Browser Basic Application</a> example except run through a node server.</p>
                    <p>There is a decision shape that calls itself until the value <code>data.a > 10</code> at which point it terminates and calls the complete function.</p>
                    
                    
                <a class="btn btn-success" href="../Node-BasicApp.zip" target="_blank" onclick="_gaq.push(['_trackEvent', 'Example actions', 'Example links', 'Node-BasicApp']);">
                    Download &raquo;</a>
                        </p>
            <ul id="myTab" class="nav nav-tabs">
              <li class="active"><a href="#overview" data-toggle="tab">Overview</a></li>
              <li><a href="#serverCode" data-toggle="tab">Server.js</a></li>
              <li><a href="#appJS" data-toggle="tab">App.js</a></li>
              <li><a href="#json" data-toggle="tab">Json.js</a></li>
              </li>
            </ul> 
            <div id="myTabContent" class="tab-content">
                <div id="overview" class="tab-pane fade in active">
                    <h3>Setup</h3>
                    <p><strong>App.js</strong> contains all the functions that the decision tree will use to manipulate the object</p>
                    <p><strong>Json.js</strong> contains a JSON object for the root shape</p>
                    
                    <p>To run it download the code, open a console and type <code>node server.js</code></p>
                    
                    <h3>Object to Process</h3>
                <p>We create a new object to process. This object is passed to the decision tree and is altered by the functions in the tree.
                <p>Any functions processing the object should be aware of it's structure or handle incorrect objects by throwing an error. </p>                   
    <pre><code>//create a data object to process
        var data = { "a": 1 };</code></pre>

                    <h3>Root Shape</h3>
                    <p>Every decision tree requires a root shape to start processing at.  This example has it stored in the json.js file.
                        <p>The process and decision functions in the shape are set using processName and decideName and are referencing functions in the TestApp e.g. <code>"processName": "TestApp.add"</code> and <code>"decideName": "TestApp.checkValue"</code></p>
                
                <pre><code class="lang-javascript">var shape = exports.shape = {
    "shapeType": "Entry",
    "id": 1,
    "description": "Start",
    "nextShape": {
        "shapeType": "Operation",
        "id": 2,
        "description": "Adding value 2",
        "nextShape": {
            "shapeType": "Decision",
            "id": 3,
            "description": "Adding value 2",
            "paths": [{
                "value": true,
                "selected": false,
                "nextShape": null,
                "nextShapeId": 3
            },
            {
                "value": false,
                "selected": false,
                "nextShape":
                    {
                        "shapeType": "Operation",
                        "id": 5,
                        "description": "Adding nothing",
                        "nextShape": null,
                        "properties": { "value": 0 },
                        "processName": "TestApp.add"
                    },
                "nextShapeId": 0
            }],
            "properties": { "value": 2, "decision": 10 },
            "processName": "TestApp.add",
            "nextShape": null,
            "decideName": "TestApp.checkValue"
        },
        "properties": { "value": 2 },
        "processName": "TestApp.add"
    }
};
                    </code>
                </pre>
                    <h3>Run Test</h3>
                <p>The TestApp is added to the <code>decisionTree.execute</code> function along with the standed options of the root shape, the data object to process and sets a callback function to be called on complete.</p>                                       
                    <p>For more information on sending apps to the execute function check out the <a href="../../documentation.html#ExecuteNode">documentation</a></p>
    <pre><code>
//execute the tree on the root shape
decisionTree.execute(tree.shape, data, TestApp.complete, { "TestApp": TestApp });</code></pre>
                </div>
              <div class="tab-pane fade" id="serverCode">
                <pre><code class="lang-javascript">var TestApp = require("./app.js");
var tree = require("./json.js");
var decisionTree = require("./decisionTree.min.js");

//create a data object to process
var data = { "a": 1 };

//execute the tree on the root shape
decisionTree.execute(tree.shape, data, TestApp.complete, { "TestApp": TestApp });
                    </code>
                </pre>
                </div>
              <div class="tab-pane fade" id="appJS">
                <pre><code class="lang-javascript">var TestApp = exports;
(function (TestApp) {
    //logs messages to the console
    TestApp.log = function (message) {
        console.log(message);
    };
    //add function
    function add(data, shape, callback) {
        try {
            TestApp.log("*************");
            TestApp.log("add function called");
            TestApp.log("data.a=" + data.a);
            var v = Number(shape.properties.value);
            if(isNaN(v)) {
                throw new Error("'" + v + "' is not a number");
            }
            TestApp.log("adding: " + v);
            data.a += v;
            TestApp.log("data.a=" + data.a);
            callback(null, shape);
        } catch (e) {
            callback(e, shape);
        }
    }
    TestApp.add = add;
    //check value function
    function checkValue(data, shape, callback) {
        try  {
            TestApp.log("*************");
            TestApp.log("checkValue function called");
            TestApp.log("checking data.a (" + data.a + ") is less than shape.properties.decision (" + shape.properties.decision + ")");
            if(data.a < shape.properties.decision) {
                TestApp.log("data.a < shape.properties.decision selecting path[0]");
                shape.paths[0].selected = true;
                shape.paths[1].selected = false;
            } else {
                TestApp.log("data.a >= shape.properties.decision selecting path[1]");
                shape.paths[0].selected = false;
                shape.paths[1].selected = true;
            }
            callback(null, shape);
        } catch (e) {
            callback(e, shape);
        }
    }
    TestApp.checkValue = checkValue;
    //complete function
    function complete(err, result, processedShapes) {
        TestApp.log("*************");
        TestApp.log("complete function called");
        TestApp.log("error: " + err);
        TestApp.log("result: " + result.a);
        for(var x = 0; x < processedShapes.length; x++) {
            TestApp.log("processed Shape: " + processedShapes[x].description + " id:" + processedShapes[x].id);
        }
        TestApp.log("Processed shapes JSON");
        //TestApp.log(JSON.stringify(processedShapes));
    }
    TestApp.complete = complete;
})(TestApp || (TestApp = {}));

                    </code>
                </pre>
                </div>
              <div class="tab-pane fade" id="json">
                <pre><code class="lang-javascript">var shape = exports.shape = {
    "shapeType": "Entry",
    "id": 1,
    "description": "Start",
    "nextShape": {
        "shapeType": "Operation",
        "id": 2,
        "description": "Adding value 2",
        "nextShape": {
            "shapeType": "Decision",
            "id": 3,
            "description": "Adding value 2",
            "paths": [{
                "value": true,
                "selected": false,
                "nextShape": null,
                "nextShapeId": 3
            },
            {
                "value": false,
                "selected": false,
                "nextShape":
                    {
                        "shapeType": "Operation",
                        "id": 5,
                        "description": "Adding nothing",
                        "nextShape": null,
                        "properties": { "value": 0 },
                        "processName": "TestApp.add"
                    },
                "nextShapeId": 0
            }],
            "properties": { "value": 2, "decision": 10 },
            "processName": "TestApp.add",
            "nextShape": null,
            "decideName": "TestApp.checkValue"
        },
        "properties": { "value": 2 },
        "processName": "TestApp.add"
    }
};
                    </code>
                </pre>
                </div>
            </div>

                </section>
            </div>
        </div>
        <footer class="well">
        <ul class="footer-links">
          <li>
            <a href="https://github.com/petecleary/decisiontreejs" target="_blank" onclick="_gaq.push(['_trackEvent', 'Footer actions', 'Footer links', 'GitHub project']);">GitHub project</a>
          </li>
          <li>
            <a href="https://github.com/petecleary/decisiontreejs/zipball/master" target="_blank" onclick="_gaq.push(['_trackEvent', 'Footer actions', 'Footer links', 'Download .zip']);">Download .zip</a>
          </li>
          <li>
            <a href="https://github.com/petecleary/decisiontreejs/tarball/maste" target="_blank" onclick="_gaq.push(['_trackEvent', 'Footer actions', 'Footer links', 'Download .tar.gz']);">Download .tar.gz</a>
          </li>
        </ul>
        <ul class="footer-links">
            <li>&copy; 2013 Pete Cleary</li>
        </ul>
      </footer>
    </div>
    <script src="../../assets/js/jquery.js"></script>
    <script src="../../assets/js/navigation.js"></script>
    <script src="../../assets/js/application.js"></script>
    <script src="../../assets/js/bootstrap-transition.js"></script>
    <script src="../../assets/js/bootstrap-collapse.js"></script>
    <script src="../../assets/js/bootstrap-scrollspy.js"></script>
    <script src="../../assets/js/bootstrap-tab.js"></script>
    <script type="text/javascript">
        $('#myTab a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        });
    </script>
</body>
</html>
